#!/usr/bin/env node

process.argv.forEach(function(o){
		if(o === '-h' || o.indexOf('help') > -1){
				console.log('usage: djsd [-hv]');
				console.log('stats dotjs server in the foreground. kill with ^C');
				process.exit(0);
		}
		if(o === '-v'){
				console.log('djsd 0.0');
				process.exit(0);
		}
});

var fs = require('fs')
, path = require('path');
var server = require('http').createServer(function(req, res){
		if(req.method === 'GET'){
				var _file = process.env.HOME + '/.js' + '/' + req.url.replace(/\//g, '')
				, _default = process.env.HOME + '/.js' +'/default.js'
				, _body = '';

				if(path.existsSync(_default)){
						_body += fs.readFileSync(_default) + '\n';
						console.log(_body);
				}
				if(req.url !== '/'){
						if(path.existsSync(_file)){
								_body += fs.readFileSync(_file) + '\n';
								console.log(_body);
						}
				}

				res.statusCode = _body === '' ? 204 : 200;
				res.setHeader('Access-Control-Allow-Origin', '*');
				res.setHeader('Content-Type', 'text/javascript');
				res.end(_body);
		}else{
				res.end('');
		}
})
server.listen(3131);